{
  "gitSyncId": "6872108d46877c6bf2e3ad57_a211a48d-0563-4bca-b202-47c89a46ac49",
  "id": "All Cases_GetCasesExpiringWithin3Years",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "SELECT \n    c.case_id,\n    c.case_number,\n    c.prelim_deadline,\n    c.lead_date,\n    c.offense_base,\n    c.responsible_district,\n    c.prelim_investigator,\n    c.inves_investigator,\n    (c.lead_date + INTERVAL '1 year' * CAST(c.offense_base AS INTEGER)) as expiration_date,\n    (c.lead_date + INTERVAL '1 year' * CAST(c.offense_base AS INTEGER)) - CURRENT_DATE as days_until_expiration,\n    -- Add classification columns for table filtering with 3 warning levels\n    CASE \n        WHEN (c.lead_date + INTERVAL '1 year' * CAST(c.offense_base AS INTEGER)) <= CURRENT_DATE\n        THEN 'EXPIRED'\n        WHEN (c.lead_date + INTERVAL '1 year' * CAST(c.offense_base AS INTEGER)) <= (CURRENT_DATE + INTERVAL '3 months')\n        THEN 'CRITICAL'\n        WHEN (c.lead_date + INTERVAL '1 year' * CAST(c.offense_base AS INTEGER)) <= (CURRENT_DATE + INTERVAL '6 months')\n        THEN 'HIGH'\n        WHEN (c.lead_date + INTERVAL '1 year' * CAST(c.offense_base AS INTEGER)) <= (CURRENT_DATE + INTERVAL '1 year')\n        THEN 'MEDIUM'\n    END as urgency_level,\n    -- Calculate years remaining for easy filtering\n    ROUND(\n        EXTRACT(EPOCH FROM (c.lead_date + INTERVAL '1 year' * CAST(c.offense_base AS INTEGER)) - CURRENT_DATE) / \n        (365.25 * 24 * 3600), 2\n    ) as years_remaining,\n    -- Calculate months remaining for easier understanding\n    ROUND(\n        EXTRACT(EPOCH FROM (c.lead_date + INTERVAL '1 year' * CAST(c.offense_base AS INTEGER)) - CURRENT_DATE) / \n        (30.44 * 24 * 3600), 1\n    ) as months_remaining,\n    -- Add days remaining for sorting\n    EXTRACT(DAY FROM (c.lead_date + INTERVAL '1 year' * CAST(c.offense_base AS INTEGER)) - CURRENT_DATE) as days_remaining\nFROM \n    \"case\" c\nWHERE \n    c.lead_date IS NOT NULL\n    AND c.offense_base IS NOT NULL \n    AND c.offense_base != ''\n    AND c.offense_base ~ '^[0-9]+$'\n    -- Only cases expiring within 1 year (including expired cases)\n    AND (c.lead_date + INTERVAL '1 year' * CAST(c.offense_base AS INTEGER)) <= (CURRENT_DATE + INTERVAL '1 year')\n    -- Exclude completed cases (only show cases that are NOT done)\n    AND c.case_type != '2'  -- Changed to string comparison\n    AND NOT (\n        -- Exclude cases where prelim is done\n        (c.prelim_status = 8 OR (c.prelim_result IS NOT NULL AND c.prelim_result NOT IN (0, 1, 2)))\n        AND \n        -- AND investigation is done (if prelim_result = 2, meaning it goes to investigation)\n        (c.prelim_result != 2 OR c.inves_status = 7)\n    )\n    -- SIMPLIFIED DIVISION FILTER\n    AND (\n        -- If no division selected (null, empty, or 0), show all records\n        COALESCE({{Slc_Division.selectedOptionValue || 0}}::INTEGER, 0) = 0\n        OR \n        -- If division is selected, match it with responsible_district (with safe conversion)\n        (\n            c.responsible_district IS NOT NULL \n            AND c.responsible_district != ''\n            AND c.responsible_district ~ '^[0-9]+$'\n            AND CAST(c.responsible_district AS INTEGER) = {{Slc_Division.selectedOptionValue || 0}}::INTEGER\n        )\n    )\nORDER BY \n    (c.lead_date + INTERVAL '1 year' * CAST(c.offense_base AS INTEGER)) ASC;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "mainDB",
      "isAutoGenerated": false,
      "name": "mainDB",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "GetCasesExpiringWithin3Years",
    "pageId": "All Cases",
    "runBehaviour": "AUTOMATIC",
    "userSetOnLoad": false
  }
}